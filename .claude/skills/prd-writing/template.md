# プロダクト要求定義書

## 概要

**プロダクト名:** [プロダクト名を記載]

**目的:** [このプロダクトが解決する主要な問題を1-2文で記述]

**例:**
オンライン学習塾プラットフォームで、講師と生徒をつなぎ、授業の管理、成績記録、コミュニケーションを一元化することで、学習効率を向上させる。

## 背景と課題

### 現状の課題

**例:**
- 講師は紙やExcelで生徒の成績を管理しており、データの紛失リスクがある
- 生徒と講師のコミュニケーションがメールやLINEに散在し、履歴管理が困難
- 授業スケジュールの調整に時間がかかり、効率が悪い

### 解決したい問題

**例:**
- 生徒の成績データを一元管理し、講師が簡単にアクセス・更新できるようにする
- 授業に関するコミュニケーションをプラットフォーム内で完結させる
- 授業スケジュールの予約・変更を簡単に行えるようにする

### ターゲットユーザー

**例:**
- **プライマリ:** 個人経営の学習塾講師（20-50代、ITリテラシー中程度）
- **セカンダリ:** 中学生・高校生とその保護者
- **想定ユーザー数:** 初年度500塾、生徒5,000人

## ユーザーストーリー

### ユーザー認証

**As a** 新規ユーザー（講師）
**I want to** メールアドレスとパスワードでアカウントを作成したい
**So that** サービスを利用開始できる

**受け入れ条件:**
- [ ] メールアドレス形式の検証が行われる
- [ ] パスワードは8文字以上、英数字を含む必要がある
- [ ] 確認メールが送信され、アカウントが有効化される
- [ ] 既に存在するメールアドレスでは登録できない
- [ ] 登録失敗時に適切なエラーメッセージが表示される

**優先度:** Must Have (MVP必須)

---

### ソーシャルログイン

**As a** 新規ユーザー
**I want to** Google/Facebookアカウントでログインしたい
**So that** 簡単にサービスを始められる

**受け入れ条件:**
- [ ] Google OAuth 2.0で認証できる
- [ ] Facebook Loginで認証できる
- [ ] 既存アカウントと連携できる
- [ ] 初回ログイン時に追加情報（名前など）を入力できる

**優先度:** Should Have

---

### レッスン作成

**As a** 講師
**I want to** 新しいレッスンを作成し、生徒を割り当てたい
**So that** 授業スケジュールを管理できる

**受け入れ条件:**
- [ ] レッスンのタイトル、日時、時間を設定できる
- [ ] 担当生徒を選択できる
- [ ] レッスンの詳細（内容、目標など）を記述できる
- [ ] 作成後に確認メールが生徒に送信される
- [ ] カレンダー表示でレッスンを確認できる

**優先度:** Must Have (MVP必須)

---

### 成績記録

**As a** 講師
**I want to** レッスン完了後に生徒の成績を記録したい
**So that** 学習進捗を追跡できる

**受け入れ条件:**
- [ ] スコア（0-100点）を入力できる
- [ ] 文字フィードバック（最大500文字）を記述できる
- [ ] 過去の成績履歴を一覧表示できる
- [ ] 成績記録後に生徒に通知が送信される
- [ ] グラフで成績推移を可視化できる

**優先度:** Must Have (MVP必須)

---

### 生徒のレッスン履歴確認

**As a** 生徒
**I want to** 自分の過去のレッスン履歴を確認したい
**So that** 学習内容を振り返ることができる

**受け入れ条件:**
- [ ] レッスン一覧を日付順で表示できる
- [ ] 各レッスンの詳細（日時、内容、成績）を確認できる
- [ ] 成績グラフを表示できる
- [ ] 期間でフィルタリングできる（今月、先月など）

**優先度:** Should Have

## 機能要件

### 必須機能（Must Have - MVPに含める）

**例:**
1. **ユーザー管理**
   - メールアドレス・パスワードによる新規登録
   - ログイン・ログアウト
   - パスワードリセット機能
   - ユーザープロフィール編集

2. **レッスン管理**
   - レッスンの作成・編集・削除
   - 生徒の割り当て
   - レッスンカレンダー表示
   - レッスン詳細の記録

3. **成績管理**
   - 成績記録の作成・編集
   - 成績履歴の一覧表示
   - 成績グラフの表示（折れ線グラフ）

4. **通知機能**
   - レッスン作成時の生徒への通知（メール）
   - 成績記録時の生徒への通知（メール）

### 推奨機能（Should Have - MVP後すぐに追加）

**例:**
1. **ソーシャルログイン**
   - Google OAuth 2.0
   - Facebook Login

2. **生徒のレッスン履歴確認**
   - 過去のレッスン一覧
   - 期間フィルタリング

3. **レポート機能**
   - 月次レポートの自動生成
   - PDFエクスポート

4. **リマインダー機能**
   - レッスン前日の自動リマインダー（メール）

### 将来機能（Nice to Have - 需要次第で検討）

**例:**
1. **ビデオ通話機能**
   - レッスン中のビデオ通話
   - 画面共有

2. **決済機能**
   - レッスン料金の決済
   - 請求書発行

3. **保護者向け機能**
   - 保護者アカウントの作成
   - 生徒の成績閲覧（保護者ビュー）

4. **AI推奨機能**
   - 学習内容のレコメンデーション
   - 苦手分野の自動検出

## 非機能要件

### パフォーマンス

**例:**
- **APIレスポンスタイム:** 95パーセンタイルで200ms以下
- **ページ読み込み時間:** 2秒以内（3G回線）
- **同時接続数:** 1,000接続に対応
- **データベースクエリ:** N+1問題を排除し、複雑なクエリは100ms以内

### セキュリティ

**例:**
- **通信:** HTTPS/TLS 1.3通信の強制
- **認証:** JWT（JSON Web Token）を使用、有効期限24時間
- **パスワード:** bcryptでハッシュ化（cost=12）
- **セッション:** 30分無操作でタイムアウト
- **OWASP対策:** OWASP Top 10への対策を実施
  - SQLインジェクション対策（パラメータ化クエリ）
  - XSS対策（サニタイゼーション）
  - CSRF対策（トークン検証）
- **データ保護:** 個人情報は暗号化して保存

### スケーラビリティ

**例:**
- **初期想定:** 500塾、5,000生徒
- **1年後目標:** 5,000塾、50,000生徒
- **水平スケーリング:** アプリケーションサーバーの追加で対応可能な設計
- **データベース:** 読み取りレプリカの追加でスケール
- **ストレージ:** クラウドストレージ（S3等）を使用し、容量制限なし

### 可用性

**例:**
- **目標稼働率:** 99.9%（月間ダウンタイム43分以内）
- **バックアップ:** 日次自動バックアップ、7日間保持
- **リカバリー:** RPO（目標復旧時点）24時間、RTO（目標復旧時間）4時間
- **監視:** エラー率、レスポンスタイム、サーバー負荷を24/7監視
- **障害対応:** 重大障害は1時間以内に対応開始

## 成功指標（KPI）

**SMART原則に基づいて設定:** Specific（具体的）、Measurable（測定可能）、Achievable（達成可能）、Relevant（関連性）、Time-bound（期限）

**例:**

### ビジネスKPI

1. **ユーザー登録数:**
   - 3ヶ月後: 講師500人、生徒5,000人
   - 6ヶ月後: 講師1,000人、生徒10,000人
   - 1年後: 講師5,000人、生徒50,000人

2. **月間アクティブユーザー数（MAU）:**
   - 3ヶ月後: 3,000人（登録ユーザーの60%）
   - 6ヶ月後: 7,000人（登録ユーザーの70%）

3. **ユーザー登録完了率:**
   - 目標: 70%以上（登録開始から完了までのコンバージョン率）

4. **ユーザー継続率:**
   - 1ヶ月継続率: 80%以上
   - 3ヶ月継続率: 60%以上
   - 6ヶ月継続率: 50%以上

### 利用状況KPI

5. **レッスン作成数:**
   - 3ヶ月後: 月間10,000レッスン
   - 6ヶ月後: 月間25,000レッスン

6. **成績記録完了率:**
   - 目標: 90%以上（作成されたレッスンのうち成績が記録される割合）

7. **平均セッション時間:**
   - 目標: 講師10分以上、生徒5分以上

### 技術KPI

8. **システム稼働率:**
   - 目標: 99.9%以上

9. **APIレスポンスタイム:**
   - 目標: 95パーセンタイルで200ms以下

10. **エラー率:**
    - 目標: 0.1%以下（全リクエストに対するエラーの割合）

## 制約事項

### 技術的制約

**例:**
- **既存技術スタック:** Ruby on Rails API、PostgreSQL、Redisを使用する
- **互換性:** モバイルブラウザ（iOS Safari、Android Chrome）に対応する必要がある
- **外部API:** メール送信にSendGridを使用（無料プランの制限: 月間100通まで）
- **インフラ:** AWS上でホスティング（初期予算の制約により、特定のリージョンに限定）
- **データ移行:** 既存のExcelデータからのインポート機能が必要

### ビジネス制約

**例:**
- **予算:** 初期開発費用500万円、運用費用月額20万円
- **法規制:** 個人情報保護法への対応が必須（生徒の個人情報を扱うため）
- **競合:** 既存の学習管理システムと差別化する必要がある
- **契約:** 外部サービス（SendGrid、AWS）との契約が必要
- **ライセンス:** オープンソースライブラリのライセンス確認が必要

### スケジュール制約

**例:**
- **MVP完成:** 3ヶ月後（2025年3月末）
- **ベータテスト:** 4ヶ月後（2025年4月）
- **正式リリース:** 6ヶ月後（2025年6月）
- **マイルストーン:**
  - 1ヶ月後: ユーザー認証・レッスン管理の完成
  - 2ヶ月後: 成績管理・通知機能の完成
  - 3ヶ月後: MVP全体のテスト完了

## リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| **外部API（SendGrid）の障害によるメール送信失敗** | 高 | 中 | フォールバック機能の実装（別のメールサービスへの切り替え）、送信キューの実装でリトライ機能を追加 |
| **ユーザー数急増によるサーバー負荷** | 高 | 低 | AWS Auto Scalingの設定、負荷テストを事前実施、アラート設定 |
| **データベースのパフォーマンス劣化** | 中 | 中 | インデックスの適切な設定、N+1問題の排除、クエリ最適化、必要に応じて読み取りレプリカの追加 |
| **セキュリティ脆弱性の発見** | 高 | 中 | 定期的なセキュリティスキャン（Brakeman）、依存ライブラリの定期更新、ペネトレーションテストの実施 |
| **スケジュール遅延** | 中 | 中 | 2週間ごとのスプリントレビュー、MVP機能の優先順位付け、必要に応じてShould Have機能を延期 |
| **競合サービスの台頭** | 中 | 低 | 差別化ポイント（UIの使いやすさ、成績記録の詳細さ）の強化、早期リリースでユーザーを獲得 |
| **データ損失** | 高 | 低 | 日次自動バックアップ、複数リージョンへのレプリケーション、定期的なリカバリーテスト |

## 用語集

| 用語 | 定義 |
|------|------|
| **MVP** | Minimum Viable Product（実用最小限の製品）。最小限の機能でリリースし、ユーザーフィードバックを得る手法 |
| **MAU** | Monthly Active Users（月間アクティブユーザー数）。月に1回以上サービスを利用したユーザーの数 |
| **JWT** | JSON Web Token。APIの認証に使用するトークン形式 |
| **OAuth 2.0** | 外部サービス（Google、Facebookなど）を使用した認証プロトコル |
| **bcrypt** | パスワードをハッシュ化するためのアルゴリズム |
| **N+1問題** | データベースクエリの非効率な実行パターン。親レコード取得後に各子レコードを個別に取得することで発生 |
| **RPO** | Recovery Point Objective（目標復旧時点）。障害発生時に失われても許容できるデータの時間範囲 |
| **RTO** | Recovery Time Objective（目標復旧時間）。障害発生から復旧までの許容時間 |
| **OWASP Top 10** | Webアプリケーションの代表的なセキュリティリスクトップ10 |
| **レッスン** | 講師と生徒の間で行われる個別指導セッション |
| **成績記録** | レッスン完了後に講師が記録する生徒の評価とフィードバック |
